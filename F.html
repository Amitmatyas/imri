<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¤×× ×œ × ×™×”×•×œ - ×—× ×•×ª ×—×•×œ×¦×•×ª ×›×“×•×¨×’×œ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš™ï¸</text></svg>">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; background-color: #eef2f7; color: #333; direction: rtl; padding: 20px;
        }
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 10000;
        }
        #login-form-container {
            background: #fff; padding: 40px 30px; border-radius: 10px; text-align: center; width: 90%; max-width: 380px;
        }
        #login-form-container input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        #login-button { background: #dc3545; color: #fff; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; font-size: 1.1em; }
        
        .container { max-width: 1100px; margin: 20px auto; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #2c3e50; }
        
        /* ×ª×™×‘×ª ×—×™×¤×•×© */
        .search-box {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .search-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
        }
        .search-box input:focus {
            outline: none;
            border-color: #007bff;
        }
        
        /* ×”×–×× ×•×ª */
        .order-card {
            background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 15px; margin-bottom: 10px;
            cursor: pointer;
        }
        .order-card:hover { background: #e9ecef; }
        .order-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .status-badge { background: #ffc107; padding: 4px 10px; border-radius: 10px; font-size: 0.85em; display: inline-block; margin-right: 10px; }
        .completed-badge { background: #28a745; color: white; }
        
        .order-status-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #dee2e6;
        }
        .order-status-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        /* ××•×¦×¨×™× */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        
        .products-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .product-card { background: #fff; border: 1px solid #eee; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .product-card img { width: 100%; height: 180px; object-fit: cover; border-radius: 4px; }
        
        /* ××•×“××œ×™× */
        .modal { display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: #fff; padding: 25px; border-radius: 10px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; position: relative; }
        .close-button { position: absolute; left: 15px; top: 15px; font-size: 24px; cursor: pointer; border: none; background: none; }
        
        .btn { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin: 5px 0; }
        .btn-save { background: #28a745; color: white; width: 100%; }
        .btn-delete { background: #dc3545; color: white; margin-top: 20px; width: 100%; }
        .btn-edit { background: #007bff; color: white; width: 100%; }
        .btn-complete { background: #28a745; color: white; width: 100%; }
        .status-input-group { margin-top: 20px; padding-top: 15px; border-top: 2px solid #eee; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>

    <div id="login-overlay">
        <div id="login-form-container">
            <h2>×›× ×™×¡×ª ×× ×”×œ</h2>
            <input type="text" id="username" placeholder="×©× ××©×ª××©">
            <input type="password" id="password" placeholder="×¡×™×¡××”">
            <button id="login-button">×”×ª×—×‘×¨</button>
            <p id="login-error-message" style="color: red; display: none;"></p>
        </div>
    </div>

    <div class="container" id="admin-panel-content" style="display: none;">
        <h1>× ×™×”×•×œ ×—× ×•×ª ×—×•×œ×¦×•×ª âš½</h1>

        <section>
            <h2>×”×–×× ×•×ª</h2>
            
            <div class="search-box">
                <input type="text" id="search-orders" placeholder="ğŸ” ×—×™×¤×•×© ×œ×¤×™ ×©×, ×˜×œ×¤×•×Ÿ, ××™××™×™×œ ××• ×›×ª×•×‘×ª...">
            </div>
            
            <div id="orders-list">×˜×•×¢×Ÿ...</div>
        </section>

        <hr>

        <section>
            <h2>×”×•×¡×¤×ª ××•×¦×¨ ×—×“×©</h2>
            <form id="add-product-form">
                <div class="form-group"><label>×©×:</label><input type="text" id="product-name" required></div>
                <div class="form-group"><label>××—×™×¨:</label><input type="number" id="product-price" required></div>
                <div class="form-group"><label>×ª××•× ×” (URL):</label><input type="url" id="product-image" required></div>
                <div class="form-group"><label>×ª×™××•×¨:</label><textarea id="product-description" required></textarea></div>
                <button type="submit" class="btn btn-save">×”×•×¡×£ ×œ××œ××™</button>
            </form>
        </section>

        <section>
            <h2>××œ××™ ×—×•×œ×¦×•×ª</h2>
            <div class="products-list" id="products-list"></div>
        </section>
    </div>

    <div id="edit-product-modal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('edit-product-modal')">&times;</button>
            <h3>×¢×¨×™×›×ª ××•×¦×¨</h3>
            <input type="hidden" id="edit-id">
            <div class="form-group"><label>×©×:</label><input type="text" id="edit-name"></div>
            <div class="form-group"><label>××—×™×¨:</label><input type="number" id="edit-price"></div>
            <div class="form-group"><label>×ª××•× ×”:</label><input type="url" id="edit-image"></div>
            <div class="form-group"><label>×ª×™××•×¨:</label><textarea id="edit-description"></textarea></div>
            <button class="btn btn-save" onclick="saveProductEdit()">×©××•×¨ ×©×™× ×•×™×™×</button>
            <button class="btn btn-delete" onclick="deleteProduct()">××—×§ ××•×¦×¨ ×œ×¦××™×ª×•×ª</button>
        </div>
    </div>

    <div id="order-modal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('order-modal')">&times;</button>
            <h3>×¤×¨×˜×™ ×”×–×× ×”</h3>
            <div id="order-details-body"></div>
            
            <div class="status-input-group">
                <h4>×¢×“×›×•×Ÿ ××¦×‘ ×”×–×× ×”</h4>
                <input type="hidden" id="current-order-id">
                <input type="text" id="order-status-input" placeholder="×œ×“×•×’××”: × ××¨×– / × ×©×œ×— ×œ×œ×§×•×— / ×”×•×©×œ×">
                <button class="btn btn-save" onclick="updateOrderStatus()">×¢×“×›×Ÿ ×¡×˜×˜×•×¡</button>
                <button class="btn btn-complete" onclick="markOrderComplete()">×¡××Ÿ ×›×”×•×©×œ×</button>
            </div>
        </div>
    </div>

    <script>
    // ×”×’×“×¨×•×ª Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDLHENaXTeorjL87sExB1EJrH7mrEnNYOA",
        authDomain: "timetable-titus.firebaseapp.com",
        projectId: "timetable-titus",
        storageBucket: "timetable-titus.appspot.com",
        messagingSenderId: "199146911555",
        appId: "1:199146911555:web:5d9436d716dfc6de7361f6"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ×”×ª×—×‘×¨×•×ª
    const ADMIN_USER = 'admin';
    const ADMIN_PASS = '1234';

    document.getElementById('login-button').addEventListener('click', () => {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        if(u === ADMIN_USER && p === ADMIN_PASS) {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('admin-panel-content').style.display = 'block';
            fetchOrders();
            fetchProducts();
        } else {
            alert('×¤×¨×˜×™ ×’×™×©×” ×©×’×•×™×™×');
        }
    });

    // --- × ×™×”×•×œ ××•×¦×¨×™× ---

    async function fetchProducts() {
        const container = document.getElementById('products-list');
        container.innerHTML = '×˜×•×¢×Ÿ...';
        const snap = await db.collection('soccer_shirts').orderBy('createdAt', 'desc').get();
        container.innerHTML = '';
        snap.forEach(doc => {
            const p = doc.data();
            const escaped = JSON.stringify(p).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
            container.innerHTML += `
                <div class="product-card">
                    <img src="${p.image}">
                    <h4>${p.name}</h4>
                    <p>${p.price} â‚ª</p>
                    <button class="btn btn-edit" onclick='openEditModal("${doc.id}", ${escaped})'>×¢×¨×•×š / ××—×§</button>
                </div>
            `;
        });
    }

    function openEditModal(id, data) {
        document.getElementById('edit-id').value = id;
        document.getElementById('edit-name').value = data.name;
        document.getElementById('edit-price').value = data.price;
        document.getElementById('edit-image').value = data.image;
        document.getElementById('edit-description').value = data.description;
        document.getElementById('edit-product-modal').classList.add('active');
    }

    async function saveProductEdit() {
        const id = document.getElementById('edit-id').value;
        await db.collection('soccer_shirts').doc(id).update({
            name: document.getElementById('edit-name').value,
            price: parseFloat(document.getElementById('edit-price').value),
            image: document.getElementById('edit-image').value,
            description: document.getElementById('edit-description').value
        });
        alert('×”××•×¦×¨ ×¢×•×“×›×Ÿ');
        closeModal('edit-product-modal');
        fetchProducts();
    }

    async function deleteProduct() {
        if(confirm('×œ××—×•×§ ××ª ×”××•×¦×¨ ×œ×¦××™×ª×•×ª?')) {
            const id = document.getElementById('edit-id').value;
            await db.collection('soccer_shirts').doc(id).delete();
            alert('×”××•×¦×¨ × ××—×§');
            closeModal('edit-product-modal');
            fetchProducts();
        }
    }

    // --- × ×™×”×•×œ ×”×–×× ×•×ª ---

    let allOrders = [];

    async function fetchOrders(showCompleted = false) {
        const list = document.getElementById('orders-list');
        const snap = await db.collection('orders').orderBy('orderDate', 'desc').get();
        allOrders = [];
        
        snap.forEach(doc => {
            allOrders.push({ id: doc.id, ...doc.data() });
        });
        
        displayOrders(allOrders.filter(o => showCompleted || !o.completed));
    }

    function displayOrders(orders) {
        const list = document.getElementById('orders-list');
        list.innerHTML = '';
        
        if (orders.length === 0) {
            list.innerHTML = '<p style="text-align: center; color: #999;">××™×Ÿ ×”×–×× ×•×ª ×œ×”×¦×’×”</p>';
            return;
        }
        
        orders.forEach(order => {
            const statusBadge = order.completed ? 'completed-badge' : '';
            const escaped = JSON.stringify(order).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
            
            list.innerHTML += `
                <div class="order-card" onclick='openOrderModal("${order.id}", ${escaped})'>
                    <div class="order-card-header">
                        <div>
                            <strong>#${order.id.substring(0,5)} | ${order.customerName}</strong>
                            <span class="status-badge ${statusBadge}">${order.completed ? '×”×•×©×œ×' : (order.status || '×—×“×©')}</span>
                        </div>
                        <div><strong>${order.totalAmount} â‚ª</strong></div>
                    </div>
                    <div style="font-size: 0.9em; color: #666;">
                        ×˜×œ×¤×•×Ÿ: ${order.customerPhone} | ×›×ª×•×‘×ª: ${order.customerAddress}
                    </div>
                </div>
            `;
        });
    }

    // ×—×™×¤×•×© ×”×–×× ×•×ª
    document.getElementById('search-orders').addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase().trim();
        
        if (searchTerm === '') {
            displayOrders(allOrders.filter(o => !o.completed));
            return;
        }
        
        const filtered = allOrders.filter(order => {
            const name = (order.customerName || '').toLowerCase();
            const phone = (order.customerPhone || '').toLowerCase();
            const email = (order.customerEmail || '').toLowerCase();
            const address = (order.customerAddress || '').toLowerCase();
            
            return name.includes(searchTerm) || 
                   phone.includes(searchTerm) || 
                   email.includes(searchTerm) || 
                   address.includes(searchTerm);
        });
        
        displayOrders(filtered);
    });

    function openOrderModal(id, data) {
        document.getElementById('current-order-id').value = id;
        document.getElementById('order-status-input').value = data.status || '';
        let itemsHtml = data.items.map(i => `<li>${i.productName} (x${i.quantity})</li>`).join('');
        
        document.getElementById('order-details-body').innerHTML = `
            <p><strong>×œ×§×•×—:</strong> ${data.customerName}</p>
            <p><strong>×˜×œ×¤×•×Ÿ:</strong> ${data.customerPhone}</p>
            <p><strong>××™××™×™×œ:</strong> ${data.customerEmail || '×œ× ×¦×•×™×Ÿ'}</p>
            <p><strong>×›×ª×•×‘×ª:</strong> ${data.customerAddress}</p>
            <p><strong>×¡×˜×˜×•×¡:</strong> ${data.completed ? 'âœ… ×”×•×©×œ×' : (data.status || '×—×“×©')}</p>
            <hr>
            <h4>×¤×¨×™×˜×™×:</h4>
            <ul>${itemsHtml}</ul>
            <p><strong>×¡×”"×›:</strong> ${data.totalAmount} â‚ª</p>
        `;
        document.getElementById('order-modal').classList.add('active');
    }

    async function updateOrderStatus() {
        const id = document.getElementById('current-order-id').value;
        const newStatus = document.getElementById('order-status-input').value;
        await db.collection('orders').doc(id).update({ status: newStatus });
        alert('×¡×˜×˜×•×¡ ×”×–×× ×” ×¢×•×“×›×Ÿ!');
        closeModal('order-modal');
        fetchOrders();
    }

    async function markOrderComplete() {
        const id = document.getElementById('current-order-id').value;
        if(confirm('×œ×¡××Ÿ ×”×–×× ×” ×–×• ×›×”×•×©×œ××”? ×”×™× ×ª×•×¡×ª×¨ ××”×¨×©×™××” ×”×¨××©×™×ª ××š ×ª×™×©××¨ ×‘××¢×¨×›×ª.')) {
            await db.collection('orders').doc(id).update({ 
                completed: true,
                completedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert('×”×”×–×× ×” ×¡×•×× ×” ×›×”×•×©×œ××”!');
            closeModal('order-modal');
            fetchOrders();
        }
    }

    // ×”×•×¡×¤×ª ××•×¦×¨ ×—×“×©
    document.getElementById('add-product-form').onsubmit = async (e) => {
        e.preventDefault();
        await db.collection('soccer_shirts').add({
            name: document.getElementById('product-name').value,
            price: parseFloat(document.getElementById('product-price').value),
            image: document.getElementById('product-image').value,
            description: document.getElementById('product-description').value,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert('× ×•×¡×£ ×‘×”×¦×œ×—×”');
        e.target.reset();
        fetchProducts();
    };

    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    </script>
</body>
</html>
